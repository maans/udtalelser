<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elevudtalelser (B1.4)</title>
  <link rel="stylesheet" href="app.css?v=B1.4g" />
</head>
<body>
  <header class="topbar no-print">
    <div class="brand">Elevudtalelser</div>
    <nav class="nav">
      <button id="nav-k" class="navbtn">üë§ K-elever</button>
      <button id="nav-edit" class="navbtn">Aa Redig√©r</button>
      <button id="nav-settings" class="navbtn">‚öôÔ∏é Indstillinger</button>
    </nav>
  </header>

  <main class="container">
    <!-- K-elever -->
    <section id="view-k" class="view">
      <h1 class="h1">K-elever</h1>
      <div id="libraryEmpty" class="empty hidden">
        <p><strong>Der er ingen elever endnu.</strong></p>
        <p>G√• til <em>‚öôÔ∏é Indstillinger</em> og upload elevlisten (CSV).</p>
        <button class="primary" onclick="document.getElementById('nav-settings').click()">G√• til Indstillinger</button>
      </div>
      <div id="libraryListWrap" class="panel">
        <div class="panel-head">
          <div class="muted">Klik p√• en elev for at redigere.</div>
        </div>
        <div id="studentList"></div>
      </div>
    </section>

    <!-- Redig√©r -->
    <section id="view-edit" class="view hidden">
      <div class="edit-head">
        <div>
          <h1 class="h1">Redig√©r</h1>
          <div class="muted">Kontaktl√¶rere (fra elevlisten): <span id="fromCSVTeachers"></span></div>
        </div>
        <div class="edit-nav no-print">
          <button id="prevStudent" class="btn" title="Forrige elev">‚üµ</button>
          <div id="editTitle" class="edit-title">‚Äî</div>
          <button id="nextStudent" class="btn" title="N√¶ste elev">‚ü∂</button>
          <button id="printBtn" class="primary" title="Lav PDF af den aktuelle udtalelse">üñ®Ô∏è Print / Gem som PDF</button>
        </div>
      </div>

      <div id="editEmpty" class="empty hidden">
        <p><strong>V√¶lg en elev i K-elever.</strong></p>
      </div>

      <div id="editWrap" class="grid2">
        <div class="panel">
          <div class="panel-head">
            <div class="muted" id="savedTime"></div>
          </div>

          <details open>
            <summary>Elevudvikling</summary>
            <textarea id="draftElev" rows="6" placeholder="Skriv l√¶rerens tekst..."></textarea>
          </details>

          <details>
            <summary>Praktisk afsnit</summary>
            <textarea id="draftPraktisk" rows="6" placeholder="Skriv l√¶rerens tekst..."></textarea>
          </details>

          <details>
            <summary>Funktion i kontaktgruppen</summary>
            <textarea id="draftK" rows="6" placeholder="Skriv l√¶rerens tekst..."></textarea>
          </details>

          <div class="panel-foot">
            <div>
              <div class="label">Elevens eget input (PDF/Word)</div>
              <div class="muted" id="elevinputMeta"></div>
            </div>
            <div class="row">
              <input id="elevinputFile" type="file" accept=".pdf,.doc,.docx" />
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="label">Preview</div>
            <div class="muted">Vises ogs√• ved print.</div>
          </div>
          <pre id="previewText" class="preview"></pre>
        </div>
      </div>
    </section>

    <!-- Indstillinger -->
    <section id="view-settings" class="view hidden">
      <h1 class="h1">Indstillinger</h1>

      <div class="panel">
        <div class="panel-head">
          <div class="label">Lokal lagring</div>
        </div>
        <p class="muted" id="localSaveText"></p>
        <button id="wipeAll" class="danger" title="Slet alle lokalt gemte tekster og valg i denne browser">üóë Ryd alle lokale data (denne browser)</button>
      </div>

      <div class="grid2">
        <div class="panel">
          <div class="panel-head">
            <div class="label">Navne og periode</div>
            <div class="muted">Du kan skrive fuldt navn eller initialer (fx RD, MM, MTP).</div>
          </div>

          <label>Forstandernavn <button id="editPrincipal" class="icon-btn" title="Redig√©r forstandernavn" type="button">‚úé</button></label>
          <input id="principalName" disabled placeholder="Stinne Poulsen" />

          <label>Jeg er (initialer eller navn)</label>
          <input id="meTeacher" placeholder="fx RD / MM / MTP" />
          <div class="muted">Bruges til at vise kun dine K-elever.</div>

          <label>Skole√•r (slut-√•r)</label>
          <input id="schoolYear" placeholder="2026" />
          <div class="muted">Periode s√¶ttes automatisk til August (√•r-1) ‚Üí Juni (√•r).</div>
<div class="row2">
            <div>
              <label>Periode fra</label>
              <input id="periodFrom" disabled />
            </div>
            <div>
              <label>Dato m√•ned/√•r</label>
              <input id="dateMonthYear" disabled />
            </div>
          </div>

          <div class="row2">
            <div>
              <label>Kontaktgruppe antal (auto)</label>
              <div class="readonly" id="kontaktCount">‚Äî</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="label">1) Elevliste (CSV)</div>
            <div class="muted">Skal indl√¶ses f√∏rst.</div>
          </div>
          <input id="studentsFile" type="file" accept=".csv,.txt" />
          <div class="muted small">
            Forventede kolonner (komma-, semikolon- eller tab-separeret):
            <br>‚Ä¢ Ny: Klasse, Fornavn, Efternavn, Uni-C brugernavn (eller UNIlogin/Unilogin), K√∏n, Relationer-Kontaktl√¶rer-Navn, Relationer-Anden kontaktl√¶rer-Navn.
            <br>‚Ä¢ Alternativ: Fornavn, Efternavn, Unilogin, K√∏n, Kontaktl√¶rer1, Kontaktl√¶rer2, Klasse.
          </div>

          <div id="marksImportHint" class="hint">
            <strong>Upload f√∏rst elevlisten.</strong> Fagl√¶rer-vurderinger kan f√∏rst indl√¶ses, n√•r elevlisten er p√• plads.
          </div>

          <div id="marksImportBlock" class="panel-sub hidden">
            <div class="label">2) Fagl√¶rer-vurderinger (CSV)</div>
            <div class="muted small">Importer delingsfiler fra sang/gym/elevr√•d. Import aktiverer automatisk data.</div>
            <label>Sang (CSV)</label>
            <input id="sangFile" type="file" accept=".csv,.txt" />
            <label>Gymnastik + roller (CSV)</label>
            <input id="gymFile" type="file" accept=".csv,.txt" />
            <label>Elevr√•d (CSV)</label>
            <input id="elevraadFile" type="file" accept=".csv,.txt" />
          </div>
        </div>
      </div>

      <div class="panel" id="marksEditorWrap">
        <div class="panel-head">
          <div class="label">Fagl√¶rer-arbejde (producer CSV til deling)</div>
          <div class="muted small">Udfyld her og download CSV til deling med andre l√¶rere.</div>
        </div>
        <div class="row">
          <label for="marksMode" class="sr-only">V√¶lg omr√•de</label>
          <select id="marksMode">
            <option value="sang">Sang</option>
            <option value="gym">Gymnastik + roller</option>
            <option value="elevraad">Elevr√•d</option>
          </select>

          <button id="exportSang" class="btn" title="Download sang-CSV til deling">Download Sang-CSV</button>
          <button id="exportGym" class="btn" title="Download gym-CSV til deling">Download Gym-CSV</button>
          <button id="exportElevraad" class="btn" title="Download elevr√•d-CSV til deling">Download Elevr√•d-CSV</button>
        </div>

        <div class="tableWrap">
          <table id="marksTable"></table>
        </div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div class="label">Skabelon-tekster</div>
          <div class="muted small">Skolens standardtekst er l√•st. Klik p√• blyanten for at redigere.</div>
          <div class="actions">
            <button id="tplEdit" class="btn" title="Sl√• redigering til/fra">‚úèÔ∏è Redig√©r</button>
            <button id="tplReset" class="btn" title="Gendan standardtekster">Gendan standard</button>
          </div>
        </div>

        <label>Skabelon (med pladsholdere)</label>
        <textarea id="templateText" rows="10" readonly></textarea>

        <div class="row2">
          <div>
            <label>V√¶lg snippet (vejledende sti)</label>
            <select id="snippetPath"></select>
          </div>
          <div>
            <label>Snippet-tekst</label>
            <textarea id="snippetText" rows="6" readonly class="disabled"></textarea>
          </div>
        </div>
      </div>

    </section>

    <!-- Print document -->
    <section class="print-only">
      <div class="print-header">
        <div class="print-title">Elevudtalelse</div>
        <div class="print-date" id="printDate"></div>
      </div>
      <pre id="printDoc" class="print-doc"></pre>
    </section>
  </main>

  <script src="app.js?v=B1.4g"></script>
  <script>
    // print date
    document.addEventListener("DOMContentLoaded", ()=>{
      const d = new Date();
      document.getElementById("printDate").textContent = d.toLocaleDateString("da-DK", {year:"numeric", month:"long", day:"numeric"});
    });
  </script>
</body>
</html>
